# 📡 OBS 推流详细指南

本指南将详细介绍如何使用 OBS 将电影画面和声音推流到 SRS 服务器。

## 📥 第一步：下载和安装 OBS

1. 访问 OBS 官网：https://obsproject.com/
2. 下载适合你操作系统的版本：
   - Windows: OBS-Studio-xx.x.x-Full-Installer-x64.exe
   - macOS: OBS-Studio-xx.x.x.dmg
   - Linux: 通过包管理器安装
3. 运行安装程序，按提示完成安装

## ⚙️ 第二步：基础配置

### 1. 打开 OBS 设置

点击右下角的 **"设置"** 按钮

### 2. 推流设置

进入 **"推流"** 选项卡：

```
服务：         自定义
服务器：       rtmp://你的服务器IP:1935/live
串流密钥：     room
```

**示例：**
- 如果服务器 IP 是 `123.45.67.89`
- 服务器填写：`rtmp://123.45.67.89:1935/live`
- 串流密钥填写：`room`（可以改成任何房间名）

> 💡 注意：观众需要知道房间名才能观看

### 3. 输出设置

进入 **"输出"** 选项卡：

#### 简单模式（推荐新手）
```
输出模式：     简单
视频比特率：   2500 Kbps（根据网络调整）
编码器：       软件 (x264)
音频比特率：   128 Kbps
录制格式：     mp4
```

#### 高级模式（专业用户）
```
输出模式：     高级
比特率控制：   CBR
比特率：       2500 Kbps
关键帧间隔：   2
CPU 使用预设： veryfast 或 faster
配置：         baseline
```

**比特率建议：**
- 上传带宽 5Mbps → 2000-2500 Kbps
- 上传带宽 10Mbps → 3000-4000 Kbps
- 上传带宽 20Mbps+ → 4000-6000 Kbps

### 4. 视频设置

进入 **"视频"** 选项卡：

```
基础(画布)分辨率：  1920x1080
输出(缩放)分辨率：  1920x1080
缩小过滤器：        兰索斯（锐化缩放，36个采样）
常用 FPS 值：       30 或 25
```

**分辨率建议：**
- 高清推流：1920x1080 (1080p)
- 标清推流：1280x720 (720p) - 网络较差时使用

### 5. 音频设置

进入 **"音频"** 选项卡：

```
采样率：       44.1 kHz 或 48 kHz
声道：         立体声
```

### 6. 高级设置（可选）

进入 **"高级"** 选项卡：

```
进程优先级：     高
渲染器：         Direct3D 11 (Windows)
色彩格式：       NV12
色彩空间：       709
色彩范围：       有限
```

## 🎬 第三步：添加视频源

### 方法一：窗口捕获（推荐）

这是推荐的方式，可以只捕获播放器窗口。

1. 在 **"来源"** 区域点击 **"+"** 号
2. 选择 **"窗口捕获"**
3. 命名为 "电影播放器"
4. 在窗口列表中选择你的播放器窗口（如 VLC、PotPlayer 等）
5. 设置选项：
   ```
   窗口：         [你的播放器窗口]
   捕获方法：     自动
   窗口匹配优先级：窗口标题必须匹配
   捕获光标：     ❌（不勾选）
   ```
6. 点击 **"确定"**

**优点：**
- 只捕获播放器窗口，不会泄露其他内容
- 可以在不影响推流的情况下操作其他窗口
- 资源占用较低

### 方法二：显示器捕获

捕获整个屏幕，适合全屏播放。

1. 在 **"来源"** 区域点击 **"+"** 号
2. 选择 **"显示器捕获"**
3. 命名为 "主显示器"
4. 选择要捕获的显示器
5. 点击 **"确定"**

**注意：** 你在电脑上的所有操作都会被观众看到！

### 方法三：媒体源（直接播放）

直接在 OBS 中播放视频文件。

1. 在 **"来源"** 区域点击 **"+"** 号
2. 选择 **"媒体源"**
3. 勾选 **"本地文件"**
4. 点击 **"浏览"** 选择电影文件
5. 设置选项：
   ```
   循环：         ✓（如需重复播放）
   重启回放当输入变为激活状态： ❌
   当源不可见时播放：           ✓
   ```

**优点：**
- OBS 直接控制播放
- 不需要外部播放器

**缺点：**
- 不能暂停、快进（需要重新设置）

## 🔊 第四步：添加音频源

### 捕获系统声音（播放器声音）

1. 在 **"来源"** 区域点击 **"+"** 号
2. 选择 **"音频输出捕获"**
3. 命名为 "系统声音"
4. 设备选择 **"默认"** 或你的音频输出设备
5. 点击 **"确定"**

### 添加麦克风（可选，用于解说）

1. 在 **"来源"** 区域点击 **"+"** 号
2. 选择 **"音频输入捕获"**
3. 选择你的麦克风设备
4. 调整音量混音器中的音量条

## 🎨 第五步：场景布局调整

1. **调整画面大小**
   - 选中视频源，拖动边框调整大小
   - 右键源 → 变换 → 适应屏幕

2. **添加文字（可选）**
   - 添加 "文本(GDI+)" 源
   - 输入房间名或欢迎词
   - 设置字体、颜色、大小

3. **添加图片（可选）**
   - 添加 "图像" 源
   - 可添加 Logo 或装饰图片

## 🚀 第六步：开始推流

### 推流前检查清单

- [ ] 推流设置中的服务器地址正确
- [ ] 串流密钥已设置
- [ ] 视频源已添加且有画面
- [ ] 音频混音器中有音频波形
- [ ] 网络连接稳定

### 开始推流

1. 点击右下角 **"开始推流"** 按钮
2. 状态栏会显示：
   ```
   🔴 直播中 | ⏱️ 00:05:23 | ⬆️ 2500 kbps | 📊 CPU: 15%
   ```
3. 在播放器中播放电影
4. 告诉观众访问网页观看

### 推流状态指标

**正常状态：**
- 码率稳定在设定值附近（±300 Kbps）
- CPU 使用率 < 50%
- 丢帧率 < 1%
- 状态栏显示绿色方块

**异常状态需要调整：**
- ⚠️ 黄色/红色方块：网络不稳定
- ⚠️ 码率波动大：上传带宽不足，降低比特率
- ⚠️ CPU > 80%：降低分辨率或使用 GPU 编码
- ⚠️ 丢帧率 > 5%：网络质量差，降低比特率

## 🎮 第七步：推流控制

### 基本控制

- **暂停推流**：点击 "停止推流" → 播放完毕或休息时
- **调整音量**：拖动音频混音器的音量条
- **静音**：点击音频混音器的 🔇 图标

### 场景切换

可以创建多个场景，比如：
- 场景1：电影播放
- 场景2：等待画面（开场前）
- 场景3：结束画面（电影结束）

切换场景只需点击场景列表中的对应项。

## 🔧 常见问题解决

### 问题1：推流失败，显示"无法连接"

**解决方案：**
1. 检查服务器地址是否正确
2. ping 服务器 IP 检查网络连通性
3. 检查防火墙是否阻止 OBS
4. 确认 SRS 服务器正在运行
5. 尝试使用其他推流地址

### 问题2：没有声音

**解决方案：**
1. 检查 "音频输出捕获" 是否添加
2. 确认选择了正确的音频设备
3. 查看音频混音器是否有音频波形
4. 检查音量条是否静音
5. 在播放器中播放音频测试

### 问题3：画面卡顿

**解决方案：**
1. 降低输出分辨率（1080p → 720p）
2. 降低视频比特率（4000 → 2500 Kbps）
3. 调整编码器预设：ultrafast（质量低但流畅）
4. 使用硬件编码（NVENC、QuickSync、AMD）
5. 关闭其他占用网络的程序

### 问题4：CPU 占用过高

**解决方案：**
1. 降低分辨率
2. 使用硬件编码器：
   - NVIDIA GPU: NVENC H.264
   - Intel GPU: QuickSync H.264
   - AMD GPU: H264/AVC Encoder (AMD)
3. 调整 CPU 预设为 "ultrafast" 或 "superfast"
4. 关闭预览（右键预览窗口 → 禁用预览）

### 问题5：播放器窗口捕获黑屏

**解决方案：**
1. 尝试不同的捕获方法：
   - Windows 10 版本捕获
   - BitBlt
   - Windows Graphics Capture
2. 在播放器设置中关闭硬件加速
3. 使用显示器捕获代替窗口捕获
4. 更新显卡驱动

## 📊 推荐配置方案

### 方案一：高清流畅（推荐）
```
分辨率：     1920x1080
帧率：       30 FPS
比特率：     3000 Kbps
编码器：     x264
预设：       veryfast
音频：       128 Kbps

需求：上传带宽 5Mbps+，CPU i5 或更好
```

### 方案二：标清省带宽
```
分辨率：     1280x720
帧率：       25 FPS
比特率：     1500 Kbps
编码器：     x264
预设：       ultrafast
音频：       96 Kbps

需求：上传带宽 3Mbps+，CPU i3 或更好
```

### 方案三：硬件编码（低 CPU 占用）
```
分辨率：     1920x1080
帧率：       30 FPS
比特率：     4000 Kbps
编码器：     NVENC H.264
预设：       Quality
音频：       128 Kbps

需求：NVIDIA GTX 900 系列或更新显卡
```

## 🎯 最佳实践

1. **测试推流**：正式使用前先测试 5-10 分钟
2. **稳定网络**：使用有线网络而非 WiFi
3. **关闭自动更新**：避免推流时系统自动更新
4. **准备备用方案**：网络不稳定时的降级配置
5. **监控状态**：关注 OBS 状态栏的各项指标
6. **定期保存场景**：场景集 → 导出

## 📞 获取帮助

如果遇到其他问题：
- OBS 官方论坛：https://obsproject.com/forum/
- OBS 中文社区：https://obsproject.com/forum/list/chinese.43/
- 查看 OBS 日志：帮助 → 日志文件 → 上传当前日志文件

---

**祝推流顺利！🎬**

